
// 7 ,settleProfitPlSum  settleLossPlSum  settleEvenPlSum

SELECT
JE.CURRENCY_PAIR,JE.CUSTOMER_ID ,
SUM(CASE WHEN JCB.SPOT_PL=0 THEN JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE ELSE 0 END) AS PL_E_AMOUNT2,
SUM(CASE WHEN JCB.SPOT_PL>0 THEN JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE ELSE 0 END) AS PL_U_AMOUNT2,
SUM(CASE WHEN JCB.SPOT_PL<0 THEN JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE ELSE 0 END) AS PL_D_AMOUNT2
FROM JHF_ALIVE_EXECUTION JE ,JHF_ALIVE_CONTRACT_BIND JCB 
WHERE JE.EXECUTION_ID=JCB.EXECUTION_ID
AND JE.EXECUTION_DATE BETWEEN '20120613'AND  '20120614' 
AND JE.TRADE_TYPE IN (1,2)  AND JE.CUSTOMER_ID='00000120' 
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
AND JCB.ACTIVE_FLAG=1  GROUP BY JE.CURRENCY_PAIR 

UNION ALL 
SELECT
JE.CURRENCY_PAIR,JE.CUSTOMER_ID ,
SUM(CASE WHEN JCB.SPOT_PL=0 THEN JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE ELSE 0 END) AS PL_E_AMOUNT2,
SUM(CASE WHEN JCB.SPOT_PL>0 THEN JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE ELSE 0 END) AS PL_U_AMOUNT2,
SUM(CASE WHEN JCB.SPOT_PL<0 THEN JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE ELSE 0 END) AS PL_D_AMOUNT2
FROM JHF_FINISHED_EXECUTION JE ,JHF_FINISHED_CONTRACT_BIND JCB 
WHERE JE.EXECUTION_ID=JCB.EXECUTION_ID
AND JE.EXECUTION_DATE BETWEEN '20120613'AND  '20120614' 
AND JE.TRADE_TYPE IN (1,2)  AND JE.CUSTOMER_ID='00000120' 
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
AND JCB.ACTIVE_FLAG=1
GROUP BY JE.CURRENCY_PAIR ;












// ? [??]      ????? ?????            

        /**
            A????????????????		
            B????????????????		
            C??????0???????????
            ????=A/(A+B+C)							
            ????=B/(A+B+C)							
            ????=C/(A+B+C)							

        **/


SELECT
COUNT(CASE WHEN JCB.SPOT_PL=0 THEN JE.EXECUTION_ID ELSE NULL END) AS PL_E_COUNT,
COUNT(CASE WHEN JCB.SPOT_PL>0 THEN JE.EXECUTION_ID  ELSE NULL END) AS PL_U_COUNT,
COUNT(CASE WHEN JCB.SPOT_PL<0 THEN JE.EXECUTION_ID  ELSE NULL END) AS PL_D__COUNT
FROM JHF_ALIVE_EXECUTION JE ,JHF_ALIVE_CONTRACT_BIND JCB 
WHERE JE.EXECUTION_ID=JCB.EXECUTION_ID
AND JE.EXECUTION_DATE BETWEEN '20110101'AND  '20120331' 
AND JE.TRADE_TYPE IN (1,2)  AND JE.CUSTOMER_ID='00078662' 
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
AND JCB.ACTIVE_FLAG=1 ;








// ? ???????    
        /**
            A???????????	
            B???????????	
            ?=A/?A+B?				
            ?=B/?A+B?				
        **/

SELECT JE.SIDE,COUNT(JE.EXECUTION_ID) AS COUNT
FROM JHF_ALIVE_EXECUTION JE 
WHERE JE.EXECUTION_DATE BETWEEN  '20110101'AND  '20120331' 
AND JE.TRADE_TYPE IN (0)  AND JE.CUSTOMER_ID='00078662'  
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
GROUP BY JE.SIDE ;







// 10 



SELECT
JE.CURRENCY_PAIR,
SUM(JE.EXECUTION_AMOUNT) AS LOT,
SUM(JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE) AS AMOUT2
FROM JHF_ALIVE_EXECUTION JE 
WHERE JE.EXECUTION_DATE BETWEEN  '20120409'AND  '20120410' 
AND JE.TRADE_TYPE IN (1,2)  AND JE.CUSTOMER_ID='00000120'  
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
GROUP BY JE.CURRENCY_PAIR




// 11   ??????


SELECT
JE.CURRENCY_PAIR,
SUM(JE.EXECUTION_AMOUNT) AS AMOUNT1,
SUM(JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE) AS AMOUNT2
FROM JHF_ALIVE_EXECUTION JE ,JHF_ALIVE_CONTRACT_BIND JCB 
WHERE JE.EXECUTION_ID=JCB.EXECUTION_ID
AND JE.EXECUTION_DATE BETWEEN  '20110101'AND  '20120331' 
AND JE.TRADE_TYPE IN (1,2)  AND JE.CUSTOMER_ID='00078662'  
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
AND JCB.ACTIVE_FLAG=1
AND JCB.SPOT_PL>0
GROUP BY JE.CURRENCY_PAIR






// 12   ??????



SELECT
JE.CURRENCY_PAIR,
SUM(JE.EXECUTION_AMOUNT) AS AMOUNT1,
SUM(JE.EXECUTION_AMOUNT*JE.EXECUTION_PRICE) AS AMOUNT2
FROM JHF_ALIVE_EXECUTION JE ,JHF_ALIVE_CONTRACT_BIND JCB 
WHERE JE.EXECUTION_ID=JCB.EXECUTION_ID
AND JE.EXECUTION_DATE BETWEEN   '20110101'AND  '20120331' 
AND JE.TRADE_TYPE IN (1,2)  AND JE.CUSTOMER_ID='00078662'  
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
AND JCB.ACTIVE_FLAG=1
AND JCB.SPOT_PL<0
GROUP BY JE.CURRENCY_PAIR




// 9  ~~~~  new  sql



SELECT T.SIDE SD,SUM(T.COUNT) CNT FROM (
SELECT
JE.SIDE,
COUNT(JE.EXECUTION_ID) AS COUNT
FROM JHF_ALIVE_EXECUTION JE 
WHERE JE.EXECUTION_DATE BETWEEN '20120607'AND  '20120618' 
AND JE.TRADE_TYPE = 0  AND JE.CUSTOMER_ID= '00000120'
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
GROUP BY JE.SIDE 

UNION ALL 

SELECT
JE.SIDE,
COUNT(JE.EXECUTION_ID) AS COUNT
FROM JHF_FINISHED_EXECUTION JE 
WHERE JE.EXECUTION_DATE BETWEEN '20120607'AND  '20120618' 
AND JE.TRADE_TYPE = 0  AND JE.CUSTOMER_ID= '00000120'
AND JE.FORCE_RELATION_FLAG=0 
AND JE.ACTIVE_FLAG=1
GROUP BY JE.SIDE ) T
GROUP BY T.SIDE ORDER BY T.SIDE ASC


